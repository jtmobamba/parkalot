<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login - ParkaLot</title>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Nunito', sans-serif;
      min-height: 100vh;
      display: flex;
    }

    .left-panel {
      flex: 1;
      background: linear-gradient(135deg, #1e40af 0%, #3b82f6 50%, #60a5fa 100%);
      display: flex;
      flex-direction: column;
      justify-content: center;
      padding: 60px;
      position: relative;
      overflow: hidden;
    }

    .left-panel::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: url('images/IMG_0073.jpeg') center/cover;
      opacity: 0.15;
    }

    .left-content {
      position: relative;
      z-index: 1;
      color: white;
      max-width: 500px;
    }

    .left-content h1 {
      font-family: 'Poppins', sans-serif;
      font-size: 48px;
      font-weight: 700;
      margin-bottom: 20px;
      line-height: 1.2;
    }

    .left-content p {
      font-size: 20px;
      opacity: 0.9;
      margin-bottom: 40px;
      line-height: 1.6;
    }

    .features-list {
      list-style: none;
    }

    .features-list li {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 20px;
      font-size: 18px;
    }

    .feature-icon {
      width: 40px;
      height: 40px;
      background: rgba(255,255,255,0.2);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      padding: 8px;
    }

    .feature-icon img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      filter: brightness(0) invert(1);
    }

    .right-panel {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 40px;
      background: white;
    }

    .auth-container {
      width: 100%;
      max-width: 420px;
    }

    .logo {
      text-align: center;
      margin-bottom: 40px;
    }

    .logo a {
      font-family: 'Poppins', sans-serif;
      font-size: 28px;
      font-weight: 700;
      color: #2563eb;
      text-decoration: none;
    }

    .auth-tabs {
      display: flex;
      margin-bottom: 30px;
      background: #f3f4f6;
      border-radius: 12px;
      padding: 5px;
    }

    .auth-tab {
      flex: 1;
      padding: 14px;
      border: none;
      background: none;
      font-size: 16px;
      font-weight: 600;
      color: #6b7280;
      cursor: pointer;
      border-radius: 10px;
      transition: all 0.3s;
    }

    .auth-tab.active {
      background: white;
      color: #2563eb;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .auth-form { display: none; }
    .auth-form.active { display: block; }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      font-size: 14px;
      font-weight: 600;
      color: #374151;
      margin-bottom: 8px;
    }

    .form-group input {
      width: 100%;
      padding: 14px 16px;
      border: 2px solid #e5e7eb;
      border-radius: 10px;
      font-size: 16px;
      transition: border-color 0.3s;
    }

    .form-group input:focus {
      outline: none;
      border-color: #2563eb;
    }

    .form-message {
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 20px;
      font-size: 14px;
      display: none;
    }

    .form-message.error {
      background: #fef2f2;
      color: #dc2626;
      border: 1px solid #fecaca;
      display: block;
    }

    .form-message.success {
      background: #f0fdf4;
      color: #16a34a;
      border: 1px solid #bbf7d0;
      display: block;
    }

    .submit-btn {
      width: 100%;
      padding: 16px;
      background: #2563eb;
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.3s;
    }

    .submit-btn:hover {
      background: #1d4ed8;
    }

    .form-footer {
      text-align: center;
      margin-top: 20px;
    }

    .form-footer a {
      color: #2563eb;
      text-decoration: none;
      font-weight: 600;
    }

    .form-footer a:hover {
      text-decoration: underline;
    }

    .divider {
      display: flex;
      align-items: center;
      margin: 25px 0;
      color: #9ca3af;
      font-size: 14px;
    }

    .divider::before, .divider::after {
      content: '';
      flex: 1;
      height: 1px;
      background: #e5e7eb;
    }

    .divider span {
      padding: 0 15px;
    }

    .quick-actions {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .quick-btn {
      width: 100%;
      padding: 14px;
      border: 2px solid #e5e7eb;
      border-radius: 10px;
      background: white;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      transition: all 0.3s;
      text-decoration: none;
      color: #374151;
    }

    .quick-btn:hover {
      border-color: #2563eb;
      background: #eff6ff;
    }

    .back-home {
      text-align: center;
      margin-top: 30px;
    }

    .back-home a {
      color: #6b7280;
      text-decoration: none;
      font-size: 14px;
    }

    .back-home a:hover {
      color: #2563eb;
    }

    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .modal.active { display: flex; }

    .modal-content {
      background: white;
      border-radius: 16px;
      padding: 30px;
      max-width: 450px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
    }

    .modal-header h2 {
      font-family: 'Poppins', sans-serif;
      font-size: 24px;
      color: #1f2937;
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 28px;
      cursor: pointer;
      color: #9ca3af;
    }

    .otp-input {
      text-align: center;
      font-size: 28px !important;
      letter-spacing: 8px;
      font-weight: 700;
    }

    @media (max-width: 992px) {
      body { flex-direction: column; }
      .left-panel { display: none; }
      .right-panel { min-height: 100vh; }
    }
  </style>
</head>
<body>

  <div class="left-panel">
    <div class="left-content">
      <h1>The smarter way to park</h1>
      <p>Join thousands of drivers who save time and money by booking parking in advance.</p>
      <ul class="features-list">
        <li>
          <div class="feature-icon"><img src="images/icons/globe.svg" alt="Globe"></div>
          <span>Thousands of spaces across the UK</span>
        </li>
        <li>
          <div class="feature-icon"><img src="images/icons/payment.svg" alt="Payment"></div>
          <span>Secure and easy payments</span>
        </li>
        <li>
          <div class="feature-icon"><img src="images/icons/smartwatch.svg" alt="Mobile"></div>
          <span>Manage bookings on the go</span>
        </li>
        <li>
          <div class="feature-icon"><img src="images/icons/star.svg" alt="Star"></div>
          <span>Verified reviews from real users</span>
        </li>
      </ul>
    </div>
  </div>

  <div class="right-panel">
    <div class="auth-container">
      <div class="logo">
        <a href="home.html">ParkaLot</a>
      </div>

      <div class="auth-tabs">
        <button class="auth-tab active" onclick="switchTab('login')">Login</button>
        <button class="auth-tab" onclick="switchTab('register')">Register</button>
      </div>

      <!-- Login Form -->
      <form class="auth-form active" id="loginForm">
        <div id="loginMessage" class="form-message"></div>

        <div class="form-group">
          <label>Email address</label>
          <input type="email" id="login_email" placeholder="Enter your email" required>
        </div>

        <div class="form-group">
          <label>Password</label>
          <input type="password" id="login_password" placeholder="Enter your password" required>
        </div>

        <button type="submit" class="submit-btn">Sign in</button>

        <div class="form-footer">
          <a href="#" onclick="showForgotPasswordModal()">Forgot your password?</a>
        </div>
      </form>

      <!-- Register Form -->
      <form class="auth-form" id="registerForm">
        <div id="registerMessage" class="form-message"></div>

        <div class="form-group">
          <label>Full name</label>
          <input type="text" id="reg_name" placeholder="Enter your full name" required>
        </div>

        <div class="form-group">
          <label>Email address</label>
          <input type="email" id="reg_email" placeholder="Enter your email" required>
        </div>

        <div class="form-group">
          <label>Password</label>
          <input type="password" id="reg_password" placeholder="Create a password (min 8 characters)" required minlength="8">
        </div>

        <button type="submit" class="submit-btn">Create account</button>

        <p style="font-size: 12px; color: #6b7280; text-align: center; margin-top: 15px;">
          By signing up, you agree to our Terms of Service and Privacy Policy
        </p>
      </form>

      <div class="divider"><span>or</span></div>

      <div class="quick-actions">
        <button class="quick-btn" onclick="showLicensePlateModal()">
          üöó Check vehicle details
        </button>
        <a href="login_vehicle_inspector.html" class="quick-btn">
          üîç Vehicle Inspector Login
        </a>
      </div>

      <div class="back-home">
        <a href="home.html">‚Üê Back to home</a>
      </div>
    </div>
  </div>

  <!-- Email Verification Modal -->
  <div id="verificationModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Verify your email</h2>
        <button class="modal-close" onclick="closeModal('verificationModal')">&times;</button>
      </div>
      <p style="color: #6b7280; margin-bottom: 25px;">We've sent a 6-digit code to your email address.</p>

      <div id="verificationMessage" class="form-message"></div>

      <div class="form-group">
        <label>Verification code</label>
        <input type="text" id="otpInput" class="otp-input" placeholder="000000" maxlength="6">
      </div>

      <button class="submit-btn" id="verifyButton">Verify email</button>

      <div class="form-footer" style="margin-top: 20px;">
        <a href="#" id="resendOtpButton">Resend code</a>
      </div>
    </div>
  </div>

  <!-- Forgot Password Modal -->
  <div id="forgotPasswordModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Reset password</h2>
        <button class="modal-close" onclick="closeModal('forgotPasswordModal')">&times;</button>
      </div>

      <div id="forgotStep1">
        <p style="color: #6b7280; margin-bottom: 25px;">Enter your email and we'll send you a reset code.</p>
        <div id="forgotMessage" class="form-message"></div>
        <div class="form-group">
          <label>Email address</label>
          <input type="email" id="forgotEmail" placeholder="Enter your email">
        </div>
        <button class="submit-btn" onclick="sendResetCode()">Send reset code</button>
      </div>

      <div id="forgotStep2" style="display: none;">
        <p style="color: #6b7280; margin-bottom: 25px;">Enter the code and your new password.</p>
        <div id="resetMessage" class="form-message"></div>
        <div class="form-group">
          <label>Reset code</label>
          <input type="text" id="resetOtpInput" class="otp-input" placeholder="000000" maxlength="6">
        </div>
        <div class="form-group">
          <label>New password</label>
          <input type="password" id="newPassword" placeholder="Min 8 characters">
        </div>
        <div class="form-group">
          <label>Confirm password</label>
          <input type="password" id="confirmPassword" placeholder="Confirm password">
        </div>
        <button class="submit-btn" onclick="resetPassword()">Reset password</button>
        <div class="form-footer" style="margin-top: 15px;">
          <a href="#" onclick="resendResetCode()">Resend code</a>
        </div>
      </div>
    </div>
  </div>

  <!-- License Plate Modal -->
  <div id="licensePlateModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Vehicle lookup</h2>
        <button class="modal-close" onclick="closeModal('licensePlateModal')">&times;</button>
      </div>
      <p style="color: #6b7280; margin-bottom: 25px;">Enter a UK registration to check vehicle details.</p>

      <div id="plateMessage" class="form-message"></div>

      <div class="form-group">
        <label>Registration number</label>
        <div style="display: flex; gap: 10px;">
          <input type="text" id="plateInput" placeholder="AB12 CDE" maxlength="10" style="flex: 1; text-transform: uppercase;">
          <button class="submit-btn" style="width: auto; padding: 14px 24px;" onclick="verifyLicensePlate()">Check</button>
        </div>
      </div>

      <div id="vehicleResults" style="display: none; margin-top: 20px; padding: 20px; background: #f9fafb; border-radius: 12px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
          <div id="resultPlate" style="background: #fbbf24; padding: 8px 16px; border-radius: 6px; font-weight: 700; font-family: monospace; font-size: 18px;">AB12 CDE</div>
          <div id="resultBadges"></div>
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; font-size: 14px;">
          <div><strong>Make:</strong> <span id="resMake">-</span></div>
          <div><strong>Model:</strong> <span id="resModel">-</span></div>
          <div><strong>Colour:</strong> <span id="resColour">-</span></div>
          <div><strong>Year:</strong> <span id="resYear">-</span></div>
          <div><strong>MOT:</strong> <span id="resMot">-</span></div>
          <div><strong>Tax:</strong> <span id="resTax">-</span></div>
        </div>
      </div>
    </div>
  </div>

<!-- GSAP Animation Library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
<script src="js/auth.js"></script>
<script>
  function switchTab(tab) {
    document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));

    if (tab === 'login') {
      document.querySelector('.auth-tab:first-child').classList.add('active');
      document.getElementById('loginForm').classList.add('active');
    } else {
      document.querySelector('.auth-tab:last-child').classList.add('active');
      document.getElementById('registerForm').classList.add('active');
    }
  }

  function closeModal(id) {
    document.getElementById(id).classList.remove('active');
  }

  function showForgotPasswordModal() {
    document.getElementById('forgotPasswordModal').classList.add('active');
    document.getElementById('forgotStep1').style.display = 'block';
    document.getElementById('forgotStep2').style.display = 'none';
  }

  function showLicensePlateModal() {
    document.getElementById('licensePlateModal').classList.add('active');
    document.getElementById('vehicleResults').style.display = 'none';
  }

  let resetEmail = '';

  function showFormMessage(elementId, message, type) {
    const el = document.getElementById(elementId);
    if (!el) return;
    el.textContent = message;
    el.className = 'form-message ' + type;
  }

  async function sendResetCode() {
    const email = document.getElementById('forgotEmail').value.trim();
    if (!email) {
      showFormMessage('forgotMessage', 'Please enter your email.', 'error');
      return;
    }

    try {
      const res = await fetch('/api/index.php?route=password/request-reset', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email })
      });
      const data = await res.json();

      if (data.success) {
        resetEmail = email;
        document.getElementById('forgotStep1').style.display = 'none';
        document.getElementById('forgotStep2').style.display = 'block';
        let msg = data.message || 'Code sent!';
        if (data.otp_code) msg += ' Code: ' + data.otp_code;
        showFormMessage('resetMessage', msg, 'success');
      } else {
        showFormMessage('forgotMessage', data.error || 'Failed to send code.', 'error');
      }
    } catch (err) {
      showFormMessage('forgotMessage', 'Network error.', 'error');
    }
  }

  async function resetPassword() {
    const otp = document.getElementById('resetOtpInput').value.trim();
    const newPass = document.getElementById('newPassword').value;
    const confirmPass = document.getElementById('confirmPassword').value;

    if (!otp || otp.length !== 6) {
      showFormMessage('resetMessage', 'Enter a valid 6-digit code.', 'error');
      return;
    }
    if (newPass.length < 8) {
      showFormMessage('resetMessage', 'Password must be at least 8 characters.', 'error');
      return;
    }
    if (newPass !== confirmPass) {
      showFormMessage('resetMessage', 'Passwords do not match.', 'error');
      return;
    }

    try {
      const res = await fetch('/api/index.php?route=password/reset', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email: resetEmail, otp_code: otp, new_password: newPass })
      });
      const data = await res.json();

      if (data.success) {
        showFormMessage('resetMessage', 'Password reset! You can now login.', 'success');
        setTimeout(() => closeModal('forgotPasswordModal'), 2000);
      } else {
        showFormMessage('resetMessage', data.error || 'Failed to reset.', 'error');
      }
    } catch (err) {
      showFormMessage('resetMessage', 'Network error.', 'error');
    }
  }

  async function resendResetCode() {
    if (!resetEmail) return;
    try {
      const res = await fetch('/api/index.php?route=password/request-reset', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email: resetEmail })
      });
      const data = await res.json();
      if (data.success) {
        let msg = 'New code sent!';
        if (data.otp_code) msg += ' Code: ' + data.otp_code;
        showFormMessage('resetMessage', msg, 'success');
      }
    } catch (err) {}
  }

  async function verifyLicensePlate() {
    const plate = document.getElementById('plateInput').value.trim().toUpperCase().replace(/\s/g, '');
    if (!plate || plate.length < 2) {
      showFormMessage('plateMessage', 'Enter a valid registration.', 'error');
      return;
    }

    showFormMessage('plateMessage', 'Checking...', 'success');

    try {
      const res = await fetch('/api/index.php?route=vehicles/public-check&plate=' + encodeURIComponent(plate));
      const data = await res.json();

      if (data.success && data.vehicle) {
        const v = data.vehicle;
        document.getElementById('plateMessage').style.display = 'none';
        document.getElementById('resultPlate').textContent = plate.length >= 7 ? plate.substring(0, 4) + ' ' + plate.substring(4) : plate;
        document.getElementById('resMake').textContent = v.make || '-';
        document.getElementById('resModel').textContent = v.model || '-';
        document.getElementById('resColour').textContent = v.colour || v.color || '-';
        document.getElementById('resYear').textContent = v.yearOfManufacture || v.year || '-';
        document.getElementById('resMot').textContent = v.motStatus || '-';
        document.getElementById('resTax').textContent = v.taxStatus || '-';
        document.getElementById('vehicleResults').style.display = 'block';
      } else {
        showFormMessage('plateMessage', data.error || 'Vehicle not found.', 'error');
      }
    } catch (err) {
      showFormMessage('plateMessage', 'Lookup failed.', 'error');
    }
  }

  // Close modals on outside click
  document.querySelectorAll('.modal').forEach(modal => {
    modal.addEventListener('click', (e) => {
      if (e.target === modal) modal.classList.remove('active');
    });
  });

  // OTP input formatting
  document.querySelectorAll('.otp-input').forEach(input => {
    input.addEventListener('input', (e) => {
      e.target.value = e.target.value.replace(/[^0-9]/g, '');
    });
  });

  document.getElementById('plateInput').addEventListener('input', (e) => {
    e.target.value = e.target.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
  });

  // GSAP Animations
  gsap.from('.left-content h1', {
    duration: 1,
    x: -50,
    opacity: 0,
    ease: 'power3.out'
  });

  gsap.from('.left-content p', {
    duration: 1,
    x: -50,
    opacity: 0,
    ease: 'power3.out',
    delay: 0.2
  });

  gsap.from('.features-list li', {
    duration: 0.6,
    x: -30,
    opacity: 0,
    stagger: 0.15,
    ease: 'power2.out',
    delay: 0.4
  });

  gsap.from('.feature-icon', {
    duration: 0.8,
    scale: 0,
    ease: 'elastic.out(1, 0.5)',
    stagger: 0.15,
    delay: 0.5
  });

  gsap.from('.auth-container', {
    duration: 1,
    y: 30,
    opacity: 0,
    ease: 'power3.out'
  });

  gsap.from('.quick-btn', {
    duration: 0.6,
    y: 20,
    opacity: 0,
    stagger: 0.1,
    ease: 'power2.out',
    delay: 0.3
  });
</script>
</body>
</html>
