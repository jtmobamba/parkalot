<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Job Application - ParkaLot</title>
  <link rel="stylesheet" href="css/style.css">
  <style>
    .application-container {
      max-width: 800px;
      margin: 0 auto;
      padding: 40px 20px;
    }
    
    .application-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 40px;
      border-radius: 10px;
      text-align: center;
      margin-bottom: 40px;
    }
    
    .form-section {
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    
    .form-section h3 {
      margin-bottom: 20px;
      color: #2c3e50;
      border-bottom: 2px solid #3498db;
      padding-bottom: 10px;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
      color: #2c3e50;
    }
    
    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 5px;
      font-size: 16px;
      transition: border-color 0.3s;
    }
    
    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: #3498db;
    }
    
    .file-upload-area {
      border: 3px dashed #3498db;
      border-radius: 10px;
      padding: 40px;
      text-align: center;
      background: #f8f9fa;
      cursor: pointer;
      transition: background 0.3s;
    }
    
    .file-upload-area:hover {
      background: #e8f4f8;
    }
    
    .file-upload-area.drag-over {
      background: #d4e9f7;
      border-color: #2980b9;
    }
    
    .file-icon {
      font-size: 60px;
      margin-bottom: 20px;
    }
    
    .file-info {
      margin-top: 20px;
      padding: 15px;
      background: white;
      border-radius: 5px;
      display: none;
    }
    
    .file-info.active {
      display: block;
    }
    
    .required {
      color: #e74c3c;
    }
    
    .success-message {
      background: #d4edda;
      color: #155724;
      padding: 20px;
      border-radius: 5px;
      margin-top: 20px;
      display: none;
    }
    
    .success-message.active {
      display: block;
    }
  </style>
</head>
<body>

<div class="application-container">
  
  <div class="application-header">
    <h1>Job Application</h1>
    <p>Join the ParkaLot Team</p>
  </div>

  <form id="jobApplicationForm" enctype="multipart/form-data">
    
    <!-- Personal Information -->
    <div class="form-section">
      <h3>Personal Information</h3>
      
      <div class="form-group">
        <label>Full Name <span class="required">*</span></label>
        <input type="text" id="fullName" name="fullName" required placeholder="Enter your full name">
      </div>
      
      <div class="form-group">
        <label>Email Address <span class="required">*</span></label>
        <input type="email" id="email" name="email" required placeholder="your.email@example.com">
      </div>
      
      <div class="form-group">
        <label>Phone Number <span class="required">*</span></label>
        <input type="tel" id="phone" name="phone" required placeholder="+44 123 456 7890">
      </div>
    </div>

    <!-- Position Details -->
    <div class="form-section">
      <h3>Position Details</h3>
      
      <div class="form-group">
        <label>Position Applied For <span class="required">*</span></label>
        <select id="position" name="position" required>
          <option value="">-- Select Position --</option>
          <option value="Parking Attendant">Parking Attendant</option>
          <option value="Senior Customer Service Representative">Senior Customer Service Representative</option>
          <option value="Facility Manager">Facility Manager</option>
          <option value="Software Developer">Software Developer</option>
          <option value="Cleaning Staff">Cleaning Staff</option>
          <option value="Security Personnel">Security Personnel</option>
          <option value="Accountant">Accountant</option>
          <option value="Other">Other</option>
        </select>
      </div>
      
      <div class="form-group">
        <label>Why do you want to work at ParkaLot?</label>
        <textarea id="coverLetter" name="coverLetter" rows="5" placeholder="Tell us about yourself and why you're interested in this position..."></textarea>
      </div>
    </div>

    <!-- User Preferences (for employee account setup) -->
    <div class="form-section">
      <h3>Parking Preferences</h3>
      <p style="color: #666; margin-bottom: 20px; font-size: 14px;">
        These preferences will be used to set up your employee account if your application is accepted.
      </p>

      <div class="form-group">
        <label>Preferred Location</label>
        <select id="preferredLocation" name="preferredLocation">
          <option value="">-- Select Preferred Location --</option>
          <option value="Manchester City Center">Manchester City Center</option>
          <option value="Manchester Airport">Manchester Airport</option>
          <option value="Stockport">Stockport</option>
          <option value="Salford Quays">Salford Quays</option>
          <option value="Oldham">Oldham</option>
          <option value="Any">Any Location</option>
        </select>
      </div>

      <div class="form-group">
        <label>Maximum Price Per Hour (GBP)</label>
        <input type="number" id="maxPricePerHour" name="maxPricePerHour" min="0" max="50" step="0.50" placeholder="e.g., 5.00">
      </div>

      <div class="form-group">
        <label>Preferred Amenities</label>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin-top: 10px;">
          <label style="font-weight: normal; display: flex; align-items: center; gap: 8px;">
            <input type="checkbox" name="amenities" value="CCTV"> CCTV Security
          </label>
          <label style="font-weight: normal; display: flex; align-items: center; gap: 8px;">
            <input type="checkbox" name="amenities" value="24/7 Access"> 24/7 Access
          </label>
          <label style="font-weight: normal; display: flex; align-items: center; gap: 8px;">
            <input type="checkbox" name="amenities" value="EV Charging"> EV Charging
          </label>
          <label style="font-weight: normal; display: flex; align-items: center; gap: 8px;">
            <input type="checkbox" name="amenities" value="Covered Parking"> Covered Parking
          </label>
          <label style="font-weight: normal; display: flex; align-items: center; gap: 8px;">
            <input type="checkbox" name="amenities" value="Security Guard"> Security Guard
          </label>
          <label style="font-weight: normal; display: flex; align-items: center; gap: 8px;">
            <input type="checkbox" name="amenities" value="Car Wash"> Car Wash
          </label>
          <label style="font-weight: normal; display: flex; align-items: center; gap: 8px;">
            <input type="checkbox" name="amenities" value="Shuttle Service"> Shuttle Service
          </label>
          <label style="font-weight: normal; display: flex; align-items: center; gap: 8px;">
            <input type="checkbox" name="amenities" value="Well Lit"> Well Lit
          </label>
        </div>
      </div>
    </div>

    <!-- CV Upload -->
    <div class="form-section">
      <h3>Upload Your CV <span class="required">*</span></h3>
      
      <div class="file-upload-area" id="fileUploadArea">
        <div class="file-icon" style="font-size: 48px; color: #3498db;">+</div>
        <h3>Drag & Drop Your CV Here</h3>
        <p>or click to browse</p>
        <p style="font-size: 14px; color: #666; margin-top: 10px;">
          Accepted formats: PDF, DOC, DOCX (Max 5MB)
        </p>
        <input type="file" id="cvFile" name="cvFile" accept=".pdf,.doc,.docx" style="display: none;" required>
      </div>
      
      <div class="file-info" id="fileInfo">
        <strong>Selected File:</strong>
        <p id="fileName"></p>
        <p id="fileSize"></p>
        <button type="button" class="btn" onclick="clearFile()" style="margin-top: 10px;">Remove File</button>
      </div>
    </div>

    <!-- Submit -->
    <div class="form-section">
      <button type="submit" class="btn primary" style="width: 100%; font-size: 18px; padding: 15px;">
        Submit Application
      </button>
      
      <div class="success-message" id="successMessage">
        <h3>Application Submitted Successfully!</h3>
        <p>Thank you for your interest in joining ParkaLot. We'll review your application and contact you soon.</p>
        <button type="button" class="btn primary" onclick="location.href='index.html'" style="margin-top: 15px;">
          Back to Homepage
        </button>
      </div>
    </div>

  </form>
  
  <div style="text-align: center; margin-top: 20px;">
    <a href="index.html" style="color: #3498db; text-decoration: none;">Back to Homepage</a>
  </div>

</div>

<script>
  const API = "../api/index.php";

  // Pre-fill position if coming from homepage
  const selectedPosition = sessionStorage.getItem('selectedPosition');
  if (selectedPosition) {
    document.getElementById('position').value = selectedPosition;
    sessionStorage.removeItem('selectedPosition');
  }

  // Get selected amenities as comma-separated string
  function getSelectedAmenities() {
    const checkboxes = document.querySelectorAll('input[name="amenities"]:checked');
    return Array.from(checkboxes).map(cb => cb.value).join(',');
  }

  // File upload handling
  const fileUploadArea = document.getElementById('fileUploadArea');
  const fileInput = document.getElementById('cvFile');
  const fileInfo = document.getElementById('fileInfo');
  
  fileUploadArea.addEventListener('click', () => {
    fileInput.click();
  });
  
  fileInput.addEventListener('change', handleFileSelect);
  
  // Drag and drop
  fileUploadArea.addEventListener('dragover', (e) => {
    e.preventDefault();
    fileUploadArea.classList.add('drag-over');
  });
  
  fileUploadArea.addEventListener('dragleave', () => {
    fileUploadArea.classList.remove('drag-over');
  });
  
  fileUploadArea.addEventListener('drop', (e) => {
    e.preventDefault();
    fileUploadArea.classList.remove('drag-over');
    
    const files = e.dataTransfer.files;
    if (files.length > 0) {
      fileInput.files = files;
      handleFileSelect();
    }
  });
  
  function handleFileSelect() {
    const file = fileInput.files[0];
    
    if (file) {
      // Validate file type
      const allowedTypes = ['application/pdf', 'application/msword', 
                           'application/vnd.openxmlformats-officedocument.wordprocessingml.document'];
      
      if (!allowedTypes.includes(file.type)) {
        alert('Please upload a PDF, DOC, or DOCX file.');
        fileInput.value = '';
        return;
      }
      
      // Validate file size (5MB max)
      const maxSize = 5 * 1024 * 1024; // 5MB in bytes
      if (file.size > maxSize) {
        alert('File size must be less than 5MB.');
        fileInput.value = '';
        return;
      }
      
      // Display file info
      document.getElementById('fileName').textContent = file.name;
      document.getElementById('fileSize').textContent = 
        `Size: ${(file.size / 1024).toFixed(2)} KB`;
      fileInfo.classList.add('active');
      
      fileUploadArea.style.borderColor = '#27ae60';
      fileUploadArea.innerHTML = `
        <div class="file-icon" style="font-size: 48px; color: #27ae60;">OK</div>
        <h3>File Selected</h3>
        <p>${file.name}</p>
      `;
    }
  }
  
  function clearFile() {
    fileInput.value = '';
    fileInfo.classList.remove('active');

    fileUploadArea.style.borderColor = '#3498db';
    fileUploadArea.innerHTML = `
      <div class="file-icon" style="font-size: 48px; color: #3498db;">+</div>
      <h3>Drag & Drop Your CV Here</h3>
      <p>or click to browse</p>
      <p style="font-size: 14px; color: #666; margin-top: 10px;">
        Accepted formats: PDF, DOC, DOCX (Max 5MB)
      </p>
    `;
  }
  
  // Form submission
  document.getElementById('jobApplicationForm').addEventListener('submit', async (e) => {
    e.preventDefault();

    const formData = new FormData();
    formData.append('full_name', document.getElementById('fullName').value);
    formData.append('email', document.getElementById('email').value);
    formData.append('phone', document.getElementById('phone').value);
    formData.append('position_applied', document.getElementById('position').value);
    formData.append('cover_letter', document.getElementById('coverLetter').value);
    formData.append('cv_file', fileInput.files[0]);

    // User preferences
    formData.append('preferred_location', document.getElementById('preferredLocation').value);
    formData.append('max_price_per_hour', document.getElementById('maxPricePerHour').value || '0');
    formData.append('preferred_amenities', getSelectedAmenities());

    try {
      const res = await fetch(API + '?route=job_application', {
        method: 'POST',
        body: formData
      });

      const data = await res.json();

      if (res.ok && data.success) {
        document.getElementById('jobApplicationForm').style.display = 'none';
        document.getElementById('successMessage').classList.add('active');
      } else {
        alert(data.error || 'Failed to submit application. Please try again.');
      }
    } catch (error) {
      console.error('Submission error:', error);
      alert('An error occurred. Please try again.');
    }
  });
</script>
</body>
</html>
