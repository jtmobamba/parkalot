<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>List Your Space - ParkaLot</title>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Nunito', sans-serif; color: #333; background: #f9fafb; min-height: 100vh; }

    .navbar { background: white; padding: 15px 5%; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 1000; }
    .navbar-brand { display: flex; align-items: center; gap: 10px; text-decoration: none; }
    .navbar-brand span { font-family: 'Poppins', sans-serif; font-size: 24px; font-weight: 700; color: #2563eb; }
    .navbar-menu { display: flex; gap: 25px; list-style: none; align-items: center; }
    .navbar-menu a { color: #333; text-decoration: none; font-weight: 600; font-size: 15px; }
    .navbar-menu a:hover { color: #2563eb; }
    .btn { padding: 12px 24px; border-radius: 8px; font-weight: 600; cursor: pointer; text-decoration: none; display: inline-flex; align-items: center; justify-content: center; gap: 8px; font-size: 15px; border: none; transition: all 0.3s; }
    .btn-primary { background: #2563eb; color: white; }
    .btn-primary:hover { background: #1d4ed8; }
    .btn-success { background: #10b981; color: white; }
    .btn-success:hover { background: #059669; }
    .btn-outline { background: transparent; color: #374151; border: 2px solid #e5e7eb; }
    .btn-outline:hover { border-color: #2563eb; color: #2563eb; }

    .page-container { max-width: 800px; margin: 0 auto; padding: 40px 5%; }

    .page-header { text-align: center; margin-bottom: 40px; }
    .page-header h1 { font-family: 'Poppins', sans-serif; font-size: 32px; font-weight: 700; color: #1f2937; margin-bottom: 10px; }
    .page-header p { color: #6b7280; font-size: 16px; }

    /* Progress Steps */
    .progress-steps { display: flex; justify-content: center; gap: 8px; margin-bottom: 40px; }
    .step { display: flex; align-items: center; gap: 8px; }
    .step-number { width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 14px; background: #e5e7eb; color: #6b7280; transition: all 0.3s; }
    .step.active .step-number { background: #2563eb; color: white; }
    .step.completed .step-number { background: #10b981; color: white; }
    .step-label { font-size: 14px; font-weight: 600; color: #6b7280; display: none; }
    .step.active .step-label { color: #2563eb; }
    .step-line { width: 40px; height: 2px; background: #e5e7eb; }
    .step-line.completed { background: #10b981; }

    @media (min-width: 768px) {
      .step-label { display: block; }
    }

    /* Form Card */
    .form-card { background: white; border-radius: 20px; padding: 40px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
    .form-section { display: none; }
    .form-section.active { display: block; }

    .section-title { font-family: 'Poppins', sans-serif; font-size: 20px; font-weight: 600; margin-bottom: 8px; color: #1f2937; }
    .section-subtitle { color: #6b7280; font-size: 14px; margin-bottom: 24px; }

    .form-group { margin-bottom: 20px; }
    .form-group label { display: block; font-size: 14px; font-weight: 600; color: #374151; margin-bottom: 8px; }
    .form-group input, .form-group select, .form-group textarea {
      width: 100%; padding: 14px 16px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 15px; font-family: 'Nunito', sans-serif; transition: all 0.3s;
    }
    .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
      outline: none; border-color: #2563eb; box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }
    .form-group textarea { min-height: 120px; resize: vertical; }
    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }

    .form-hint { font-size: 12px; color: #6b7280; margin-top: 6px; }

    /* Space Type Cards */
    .space-type-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-bottom: 20px; }
    .space-type-card { padding: 20px; border: 2px solid #e5e7eb; border-radius: 12px; cursor: pointer; text-align: center; transition: all 0.3s; }
    .space-type-card:hover { border-color: #2563eb; background: #f0f9ff; }
    .space-type-card.selected { border-color: #2563eb; background: #eff6ff; }
    .space-type-card .icon { font-size: 32px; margin-bottom: 8px; }
    .space-type-card .label { font-weight: 600; font-size: 15px; color: #1f2937; }
    .space-type-card .desc { font-size: 12px; color: #6b7280; margin-top: 4px; }

    /* Amenities Grid */
    .amenities-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
    .amenity-item { display: flex; align-items: center; gap: 10px; padding: 12px 16px; border: 2px solid #e5e7eb; border-radius: 10px; cursor: pointer; transition: all 0.3s; }
    .amenity-item:hover { border-color: #2563eb; }
    .amenity-item.selected { border-color: #2563eb; background: #eff6ff; }
    .amenity-item input { display: none; }
    .amenity-item .icon { font-size: 20px; }
    .amenity-item .label { font-weight: 600; font-size: 14px; }

    /* Price Input */
    .price-input-group { position: relative; }
    .price-input-group .currency { position: absolute; left: 16px; top: 50%; transform: translateY(-50%); font-size: 16px; font-weight: 600; color: #6b7280; }
    .price-input-group input { padding-left: 36px; }

    /* Photo Upload */
    .photo-upload-area { border: 2px dashed #e5e7eb; border-radius: 12px; padding: 40px; text-align: center; cursor: pointer; transition: all 0.3s; }
    .photo-upload-area:hover { border-color: #2563eb; background: #f0f9ff; }
    .photo-upload-area .icon { font-size: 48px; margin-bottom: 12px; }
    .photo-upload-area h4 { font-size: 16px; font-weight: 600; color: #1f2937; margin-bottom: 4px; }
    .photo-upload-area p { font-size: 13px; color: #6b7280; }
    .photo-preview { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-top: 20px; }
    .photo-preview-item { aspect-ratio: 1; border-radius: 8px; overflow: hidden; position: relative; }
    .photo-preview-item img { width: 100%; height: 100%; object-fit: cover; }
    .photo-preview-item .remove { position: absolute; top: 4px; right: 4px; width: 24px; height: 24px; background: #ef4444; color: white; border: none; border-radius: 50%; cursor: pointer; font-size: 14px; }

    /* Review Section */
    .review-section { background: #f9fafb; border-radius: 12px; padding: 24px; margin-bottom: 24px; }
    .review-item { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #e5e7eb; }
    .review-item:last-child { border-bottom: none; }
    .review-label { font-weight: 600; color: #374151; }
    .review-value { color: #6b7280; }

    /* Navigation Buttons */
    .form-navigation { display: flex; justify-content: space-between; margin-top: 32px; padding-top: 24px; border-top: 1px solid #e5e7eb; }

    /* Success Message */
    .success-message { text-align: center; padding: 40px; }
    .success-icon { font-size: 64px; margin-bottom: 20px; }
    .success-message h2 { font-family: 'Poppins', sans-serif; font-size: 28px; margin-bottom: 12px; color: #1f2937; }
    .success-message p { color: #6b7280; margin-bottom: 24px; }

    /* Error Message */
    .error-message { background: #fef2f2; color: #991b1b; padding: 12px 16px; border-radius: 8px; margin-bottom: 20px; display: none; }

    @media (max-width: 768px) {
      .form-row { grid-template-columns: 1fr; }
      .space-type-grid { grid-template-columns: 1fr; }
      .amenities-grid { grid-template-columns: 1fr; }
      .navbar-menu { display: none; }
    }
  </style>
</head>
<body>

  <nav class="navbar">
    <a href="home.html" class="navbar-brand"><span>ParkaLot</span></a>
    <ul class="navbar-menu">
      <li><a href="find-parking.html">Find Parking</a></li>
      <li><a href="customer_dashboard.html">Dashboard</a></li>
      <li><a href="#" onclick="logout(); return false;">Logout</a></li>
    </ul>
  </nav>

  <div class="page-container">
    <div class="page-header">
      <h1>List Your Parking Space</h1>
      <p>Earn money by renting out your driveway, garage, or parking spot</p>
    </div>

    <!-- Progress Steps -->
    <div class="progress-steps">
      <div class="step active" data-step="1">
        <div class="step-number">1</div>
        <span class="step-label">Location</span>
      </div>
      <div class="step-line"></div>
      <div class="step" data-step="2">
        <div class="step-number">2</div>
        <span class="step-label">Details</span>
      </div>
      <div class="step-line"></div>
      <div class="step" data-step="3">
        <div class="step-number">3</div>
        <span class="step-label">Pricing</span>
      </div>
      <div class="step-line"></div>
      <div class="step" data-step="4">
        <div class="step-number">4</div>
        <span class="step-label">Photos</span>
      </div>
      <div class="step-line"></div>
      <div class="step" data-step="5">
        <div class="step-number">5</div>
        <span class="step-label">Review</span>
      </div>
    </div>

    <div class="form-card">
      <div id="errorMessage" class="error-message"></div>

      <!-- Step 1: Location -->
      <div class="form-section active" data-step="1">
        <h3 class="section-title">Where is your space?</h3>
        <p class="section-subtitle">Enter your parking space address</p>

        <div class="form-group">
          <label>Space Name</label>
          <input type="text" id="spaceName" placeholder="e.g., Private Driveway Near City Centre" required>
          <div class="form-hint">Give your space a memorable name</div>
        </div>

        <div class="form-group">
          <label>Address Line 1</label>
          <input type="text" id="addressLine1" placeholder="Street address" required>
        </div>

        <div class="form-group">
          <label>Address Line 2 (Optional)</label>
          <input type="text" id="addressLine2" placeholder="Apartment, suite, etc.">
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>City</label>
            <input type="text" id="city" placeholder="London" required>
          </div>
          <div class="form-group">
            <label>Postcode</label>
            <input type="text" id="postcode" placeholder="SW1A 1AA" required>
          </div>
        </div>

        <div class="form-navigation">
          <div></div>
          <button type="button" class="btn btn-primary" onclick="nextStep()">Continue</button>
        </div>
      </div>

      <!-- Step 2: Details -->
      <div class="form-section" data-step="2">
        <h3 class="section-title">Space Details</h3>
        <p class="section-subtitle">Tell us about your parking space</p>

        <label style="font-size: 14px; font-weight: 600; color: #374151; margin-bottom: 12px; display: block;">Type of Space</label>
        <div class="space-type-grid">
          <div class="space-type-card selected" data-type="driveway">
            <div class="icon">üè†</div>
            <div class="label">Driveway</div>
            <div class="desc">Private driveway at home</div>
          </div>
          <div class="space-type-card" data-type="garage">
            <div class="icon">üöó</div>
            <div class="label">Garage</div>
            <div class="desc">Covered garage space</div>
          </div>
          <div class="space-type-card" data-type="parking_spot">
            <div class="icon">üÖøÔ∏è</div>
            <div class="label">Parking Spot</div>
            <div class="desc">Outdoor parking bay</div>
          </div>
          <div class="space-type-card" data-type="car_park">
            <div class="icon">üè¢</div>
            <div class="label">Car Park</div>
            <div class="desc">Commercial parking area</div>
          </div>
        </div>
        <input type="hidden" id="spaceType" value="driveway">

        <div class="form-group">
          <label>Description</label>
          <textarea id="description" placeholder="Describe your space, accessibility, and any special features..."></textarea>
        </div>

        <label style="font-size: 14px; font-weight: 600; color: #374151; margin-bottom: 12px; display: block;">Amenities</label>
        <div class="amenities-grid">
          <label class="amenity-item" data-amenity="covered">
            <input type="checkbox" value="covered">
            <span class="icon">üè†</span>
            <span class="label">Covered</span>
          </label>
          <label class="amenity-item" data-amenity="cctv">
            <input type="checkbox" value="cctv">
            <span class="icon">üìπ</span>
            <span class="label">CCTV</span>
          </label>
          <label class="amenity-item" data-amenity="ev_charging">
            <input type="checkbox" value="ev_charging">
            <span class="icon">‚ö°</span>
            <span class="label">EV Charging</span>
          </label>
          <label class="amenity-item" data-amenity="24_7_access">
            <input type="checkbox" value="24_7_access">
            <span class="icon">üïê</span>
            <span class="label">24/7 Access</span>
          </label>
          <label class="amenity-item" data-amenity="security_lighting">
            <input type="checkbox" value="security_lighting">
            <span class="icon">üí°</span>
            <span class="label">Security Lighting</span>
          </label>
          <label class="amenity-item" data-amenity="disabled_access">
            <input type="checkbox" value="disabled_access">
            <span class="icon">‚ôø</span>
            <span class="label">Disabled Access</span>
          </label>
        </div>

        <div class="form-group" style="margin-top: 20px;">
          <label>Access Instructions (Optional)</label>
          <textarea id="instructions" placeholder="How to access the space, gate codes, etc."></textarea>
        </div>

        <div class="form-navigation">
          <button type="button" class="btn btn-outline" onclick="prevStep()">Back</button>
          <button type="button" class="btn btn-primary" onclick="nextStep()">Continue</button>
        </div>
      </div>

      <!-- Step 3: Pricing -->
      <div class="form-section" data-step="3">
        <h3 class="section-title">Set Your Pricing</h3>
        <p class="section-subtitle">Choose how much to charge for your space</p>

        <div class="form-row">
          <div class="form-group">
            <label>Hourly Rate *</label>
            <div class="price-input-group">
              <span class="currency">¬£</span>
              <input type="number" id="pricePerHour" placeholder="5.00" step="0.50" min="1" required>
            </div>
            <div class="form-hint">Average in your area: ¬£4-8/hour</div>
          </div>
          <div class="form-group">
            <label>Daily Rate (Optional)</label>
            <div class="price-input-group">
              <span class="currency">¬£</span>
              <input type="number" id="pricePerDay" placeholder="25.00" step="1" min="5">
            </div>
            <div class="form-hint">Recommended: 5-6x hourly rate</div>
          </div>
        </div>

        <div class="form-row" style="margin-top: 20px;">
          <div class="form-group">
            <label>Minimum Booking (Hours)</label>
            <select id="minBookingHours">
              <option value="1">1 hour</option>
              <option value="2">2 hours</option>
              <option value="4">4 hours</option>
              <option value="8">8 hours (full day)</option>
            </select>
          </div>
          <div class="form-group">
            <label>Maximum Booking (Days)</label>
            <select id="maxBookingDays">
              <option value="7">7 days</option>
              <option value="14">14 days</option>
              <option value="30" selected>30 days</option>
              <option value="90">90 days</option>
            </select>
          </div>
        </div>

        <div style="background: #f0fdf4; border-radius: 12px; padding: 20px; margin-top: 24px;">
          <h4 style="font-size: 15px; font-weight: 600; color: #059669; margin-bottom: 8px;">Estimated Earnings</h4>
          <p style="font-size: 14px; color: #374151;">If booked 10 hours/week at <span id="estHourlyRate">¬£5.00</span>/hr:</p>
          <div style="font-size: 28px; font-weight: 700; color: #10b981; margin-top: 8px;">¬£<span id="estMonthlyEarnings">200</span>/month</div>
          <p style="font-size: 12px; color: #6b7280; margin-top: 4px;">After 15% platform fee</p>
        </div>

        <div class="form-navigation">
          <button type="button" class="btn btn-outline" onclick="prevStep()">Back</button>
          <button type="button" class="btn btn-primary" onclick="nextStep()">Continue</button>
        </div>
      </div>

      <!-- Step 4: Photos -->
      <div class="form-section" data-step="4">
        <h3 class="section-title">Add Photos</h3>
        <p class="section-subtitle">Photos help renters choose your space</p>

        <div class="photo-upload-area" onclick="document.getElementById('photoInput').click()">
          <div class="icon">üì∏</div>
          <h4>Click to upload photos</h4>
          <p>JPG, PNG up to 5MB each. Maximum 6 photos.</p>
        </div>
        <input type="file" id="photoInput" accept="image/*" multiple style="display: none;">
        <div class="photo-preview" id="photoPreview"></div>

        <div style="background: #eff6ff; border-radius: 12px; padding: 16px; margin-top: 24px;">
          <h4 style="font-size: 14px; font-weight: 600; color: #2563eb; margin-bottom: 8px;">Photo Tips</h4>
          <ul style="font-size: 13px; color: #374151; padding-left: 20px;">
            <li>Show the full parking space from multiple angles</li>
            <li>Include entrance and access points</li>
            <li>Take photos in good lighting</li>
            <li>Remove personal items from view</li>
          </ul>
        </div>

        <div class="form-navigation">
          <button type="button" class="btn btn-outline" onclick="prevStep()">Back</button>
          <button type="button" class="btn btn-primary" onclick="nextStep()">Continue</button>
        </div>
      </div>

      <!-- Step 5: Review -->
      <div class="form-section" data-step="5">
        <h3 class="section-title">Review Your Listing</h3>
        <p class="section-subtitle">Check your details before submitting</p>

        <div class="review-section">
          <div class="review-item">
            <span class="review-label">Space Name</span>
            <span class="review-value" id="reviewSpaceName">-</span>
          </div>
          <div class="review-item">
            <span class="review-label">Address</span>
            <span class="review-value" id="reviewAddress">-</span>
          </div>
          <div class="review-item">
            <span class="review-label">Type</span>
            <span class="review-value" id="reviewType">-</span>
          </div>
          <div class="review-item">
            <span class="review-label">Hourly Rate</span>
            <span class="review-value" id="reviewHourlyRate">-</span>
          </div>
          <div class="review-item">
            <span class="review-label">Daily Rate</span>
            <span class="review-value" id="reviewDailyRate">-</span>
          </div>
          <div class="review-item">
            <span class="review-label">Amenities</span>
            <span class="review-value" id="reviewAmenities">-</span>
          </div>
          <div class="review-item">
            <span class="review-label">Photos</span>
            <span class="review-value" id="reviewPhotos">0 photos</span>
          </div>
        </div>

        <div style="background: #fffbeb; border-radius: 12px; padding: 16px; margin-bottom: 24px;">
          <p style="font-size: 13px; color: #92400e;">
            <strong>Note:</strong> Your listing will be reviewed by our team before going live. This usually takes 24-48 hours.
          </p>
        </div>

        <div class="form-navigation">
          <button type="button" class="btn btn-outline" onclick="prevStep()">Back</button>
          <button type="button" class="btn btn-success" onclick="submitListing()" id="submitBtn">Submit Listing</button>
        </div>
      </div>

      <!-- Success Section -->
      <div class="form-section" data-step="success">
        <div class="success-message">
          <div class="success-icon">üéâ</div>
          <h2>Listing Submitted!</h2>
          <p>Your parking space has been submitted for review. We'll notify you once it's approved.</p>
          <div style="display: flex; gap: 12px; justify-content: center;">
            <a href="customer_dashboard.html" class="btn btn-primary">Go to Dashboard</a>
            <a href="list-your-space.html" class="btn btn-outline">List Another Space</a>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
  const API = "../api/index.php";
  let currentStep = 1;
  let photos = [];

  // Check authentication
  async function checkAuth() {
    try {
      const res = await fetch(API + "?route=me", { credentials: "same-origin" });
      if (!res.ok) {
        window.location.href = "index.html?redirect=list-your-space";
        return false;
      }
      return true;
    } catch (err) {
      window.location.href = "index.html";
      return false;
    }
  }

  function logout() {
    fetch(API + "?route=logout", { credentials: "same-origin" })
      .then(() => window.location.href = "index.html");
  }

  // Step navigation
  function nextStep() {
    if (!validateStep(currentStep)) return;
    if (currentStep < 5) {
      currentStep++;
      updateUI();
      if (currentStep === 5) populateReview();
    }
  }

  function prevStep() {
    if (currentStep > 1) {
      currentStep--;
      updateUI();
    }
  }

  function updateUI() {
    // Update sections
    document.querySelectorAll('.form-section').forEach(s => s.classList.remove('active'));
    document.querySelector(`.form-section[data-step="${currentStep}"]`).classList.add('active');

    // Update progress
    document.querySelectorAll('.step').forEach((s, i) => {
      const step = i + 1;
      s.classList.remove('active', 'completed');
      if (step === currentStep) s.classList.add('active');
      else if (step < currentStep) s.classList.add('completed');
    });

    document.querySelectorAll('.step-line').forEach((l, i) => {
      l.classList.toggle('completed', i < currentStep - 1);
    });

    window.scrollTo({ top: 0, behavior: 'smooth' });
  }

  function validateStep(step) {
    hideError();

    switch (step) {
      case 1:
        if (!document.getElementById('spaceName').value.trim()) {
          showError('Please enter a name for your space');
          return false;
        }
        if (!document.getElementById('addressLine1').value.trim()) {
          showError('Please enter the street address');
          return false;
        }
        if (!document.getElementById('city').value.trim()) {
          showError('Please enter the city');
          return false;
        }
        if (!document.getElementById('postcode').value.trim()) {
          showError('Please enter the postcode');
          return false;
        }
        break;
      case 3:
        const hourlyRate = parseFloat(document.getElementById('pricePerHour').value);
        if (!hourlyRate || hourlyRate < 1) {
          showError('Please enter a valid hourly rate (minimum ¬£1)');
          return false;
        }
        break;
    }
    return true;
  }

  function showError(message) {
    const el = document.getElementById('errorMessage');
    el.textContent = message;
    el.style.display = 'block';
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }

  function hideError() {
    document.getElementById('errorMessage').style.display = 'none';
  }

  // Space type selection
  document.querySelectorAll('.space-type-card').forEach(card => {
    card.addEventListener('click', function() {
      document.querySelectorAll('.space-type-card').forEach(c => c.classList.remove('selected'));
      this.classList.add('selected');
      document.getElementById('spaceType').value = this.dataset.type;
    });
  });

  // Amenities selection
  document.querySelectorAll('.amenity-item').forEach(item => {
    item.addEventListener('click', function() {
      this.classList.toggle('selected');
      this.querySelector('input').checked = this.classList.contains('selected');
    });
  });

  // Price estimation
  document.getElementById('pricePerHour').addEventListener('input', updateEstimate);

  function updateEstimate() {
    const hourlyRate = parseFloat(document.getElementById('pricePerHour').value) || 5;
    document.getElementById('estHourlyRate').textContent = '¬£' + hourlyRate.toFixed(2);
    const monthly = (hourlyRate * 10 * 4 * 0.85).toFixed(0); // 10hrs/week, 4 weeks, 85% (after 15% fee)
    document.getElementById('estMonthlyEarnings').textContent = monthly;
  }

  // Photo upload
  document.getElementById('photoInput').addEventListener('change', function(e) {
    const files = Array.from(e.target.files);
    const maxPhotos = 6;

    files.forEach(file => {
      if (photos.length >= maxPhotos) return;
      if (file.size > 5 * 1024 * 1024) {
        showError('File too large. Maximum 5MB per photo.');
        return;
      }

      const reader = new FileReader();
      reader.onload = function(e) {
        photos.push({ file, dataUrl: e.target.result });
        renderPhotos();
      };
      reader.readAsDataURL(file);
    });
  });

  function renderPhotos() {
    const container = document.getElementById('photoPreview');
    container.innerHTML = photos.map((p, i) => `
      <div class="photo-preview-item">
        <img src="${p.dataUrl}" alt="Photo ${i + 1}">
        <button type="button" class="remove" onclick="removePhoto(${i})">√ó</button>
      </div>
    `).join('');
  }

  function removePhoto(index) {
    photos.splice(index, 1);
    renderPhotos();
  }

  // Populate review
  function populateReview() {
    document.getElementById('reviewSpaceName').textContent = document.getElementById('spaceName').value;
    document.getElementById('reviewAddress').textContent =
      document.getElementById('addressLine1').value + ', ' +
      document.getElementById('city').value + ' ' +
      document.getElementById('postcode').value;

    const types = { driveway: 'Driveway', garage: 'Garage', parking_spot: 'Parking Spot', car_park: 'Car Park' };
    document.getElementById('reviewType').textContent = types[document.getElementById('spaceType').value] || 'Driveway';

    document.getElementById('reviewHourlyRate').textContent = '¬£' + (parseFloat(document.getElementById('pricePerHour').value) || 0).toFixed(2);
    document.getElementById('reviewDailyRate').textContent = document.getElementById('pricePerDay').value ?
      '¬£' + parseFloat(document.getElementById('pricePerDay').value).toFixed(2) : 'Not set';

    const amenities = [];
    document.querySelectorAll('.amenity-item.selected .label').forEach(l => amenities.push(l.textContent));
    document.getElementById('reviewAmenities').textContent = amenities.length ? amenities.join(', ') : 'None selected';

    document.getElementById('reviewPhotos').textContent = photos.length + ' photo' + (photos.length !== 1 ? 's' : '');
  }

  // Upload photos to server
  async function uploadPhotos() {
    if (photos.length === 0) {
      return { success: true, photos: [] };
    }

    const formData = new FormData();
    for (const photo of photos) {
      formData.append('photos[]', photo.file);
    }

    try {
      const res = await fetch(API + "?route=spaces/upload-photos", {
        method: "POST",
        credentials: "same-origin",
        body: formData
      });
      return await res.json();
    } catch (err) {
      return { error: 'Failed to upload photos' };
    }
  }

  // Submit listing
  async function submitListing() {
    const btn = document.getElementById('submitBtn');
    btn.disabled = true;
    btn.textContent = 'Uploading photos...';

    // First upload photos
    const photoResult = await uploadPhotos();
    if (photoResult.error) {
      showError(photoResult.error);
      btn.disabled = false;
      btn.textContent = 'Submit Listing';
      return;
    }

    btn.textContent = 'Creating listing...';

    const amenities = [];
    document.querySelectorAll('.amenity-item.selected input').forEach(i => amenities.push(i.value));

    const data = {
      space_name: document.getElementById('spaceName').value,
      space_type: document.getElementById('spaceType').value,
      address_line1: document.getElementById('addressLine1').value,
      address_line2: document.getElementById('addressLine2').value,
      city: document.getElementById('city').value,
      postcode: document.getElementById('postcode').value,
      description: document.getElementById('description').value,
      instructions: document.getElementById('instructions').value,
      price_per_hour: parseFloat(document.getElementById('pricePerHour').value),
      price_per_day: parseFloat(document.getElementById('pricePerDay').value) || null,
      min_booking_hours: parseInt(document.getElementById('minBookingHours').value),
      max_booking_days: parseInt(document.getElementById('maxBookingDays').value),
      amenities: amenities,
      photos: photoResult.photos || []
    };

    try {
      const res = await fetch(API + "?route=spaces", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        credentials: "same-origin",
        body: JSON.stringify(data)
      });

      const result = await res.json();

      if (result.success) {
        document.querySelectorAll('.form-section').forEach(s => s.classList.remove('active'));
        document.querySelector('.form-section[data-step="success"]').classList.add('active');
        document.querySelector('.progress-steps').style.display = 'none';
      } else {
        showError(result.error || 'Failed to create listing. Please try again.');
        btn.disabled = false;
        btn.textContent = 'Submit Listing';
      }
    } catch (err) {
      showError('Network error. Please check your connection.');
      btn.disabled = false;
      btn.textContent = 'Submit Listing';
    }
  }

  // Initialize
  checkAuth();
  updateEstimate();
</script>

</body>
</html>
